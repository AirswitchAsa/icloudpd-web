(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4180:(e,o,i)=>{Promise.resolve().then(i.bind(i,6190))},6190:(e,o,i)=>{"use strict";i.r(o),i.d(o,{default:()=>ef});var l=i(5155),n=i(2115),s=i(3166),r=i(3085),t=i(9949),a=i(5389),c=i(3420),d=i(9829),u=i(674),h=i(2403),x=i(4462),p=i(2369),j=i(3083),m=i(6677),g=i(2311),f=i(4252),b=i(4999),v=i(4825),_=i(7504),y=i(4619),C=i(7389),w=i(863),k=i(2295),S=i(5135),E=i(4681),O=i(3031),z=i(3792),D=i(1319);function P(){let[e,o]=(0,n.useState)(null);return(0,n.useEffect)(()=>{console.log("Attempting to connect to WebSocket server...");let e=(0,D.io)("/",{transports:["websocket"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,auth:{clientId:"default-user"}});return e.on("connect",()=>{console.log("Connected to Python server")}),e.on("connect_error",e=>{console.error("Socket connection error:",e.message)}),e.on("disconnect",e=>{console.log("Socket disconnected:",e)}),["policies","uploaded_policies","policies_after_save","policies_after_delete"].forEach(o=>{e.on(o,e=>{console.log("".concat(o,":"),e)})}),["error_saving_policy","error_deleting_policy","error_interrupting_download"].forEach(o=>{e.on(o,e=>{console.error("".concat(o,":"),e)})}),e.on("authenticated",e=>{console.log("Authentication successful:",e)}),e.on("authentication_failed",e=>{console.error("Authentication failed:",e)}),e.on("mfa_required",e=>{console.log("MFA required:",e)}),e.on("download_progress",e=>{console.log("Download progress:",e)}),e.on("download_finished",e=>{console.log("Download finished:",e)}),e.on("download_failed",e=>{console.error("Download failed:",e)}),o(e),()=>{console.log("Cleaning up socket connection"),e.close()}},[]),e}function R(e){let{label:o,info:i,children:n}=e,{isOpen:r,onToggle:a}=(0,s.j)();return(0,l.jsxs)(t.a,{children:[(0,l.jsxs)(u.z,{spacing:2,align:"center",mb:i&&r?2:0,children:[(0,l.jsx)(h.K,{"aria-label":"Toggle info",icon:r?(0,l.jsx)(O.M,{}):(0,l.jsx)(z.D,{}),size:"sm",variant:"ghost",onClick:a}),(0,l.jsx)(x.l,{flex:"1",mb:"0",children:o}),n]}),i&&(0,l.jsx)(p.S,{in:r,children:(0,l.jsx)(t.a,{pl:10,pr:4,py:2,bg:"gray.50",borderRadius:"md",children:(0,l.jsx)(j.E,{fontSize:"sm",color:"gray.600",children:i})})})]})}function F(e){let{isOpen:o,onClose:i,onPolicySaved:s,isEditing:a=!1,policy:u}=e,h=(0,r.d)(),x=P(),[p,O]=(0,n.useState)({name:(null==u?void 0:u.name)||"",username:(null==u?void 0:u.username)||"",directory:(null==u?void 0:u.directory)||"",domain:(null==u?void 0:u.domain)||"com",folder_structure:(null==u?void 0:u.folder_structure)||"{:%Y/%m/%d}",size:(null==u?void 0:u.size)||["original"],live_photo_size:(null==u?void 0:u.live_photo_size)||"original",force_size:(null==u?void 0:u.force_size)||!1,align_raw:(null==u?void 0:u.align_raw)||"original",keep_unicode_in_filenames:(null==u?void 0:u.keep_unicode_in_filenames)||!1,set_exif_datetime:(null==u?void 0:u.set_exif_datetime)||!1,live_photo_mov_filename_policy:(null==u?void 0:u.live_photo_mov_filename_policy)||"suffix",file_match_policy:(null==u?void 0:u.file_match_policy)||"name-size-dedup-with-suffix",xmp_sidecar:(null==u?void 0:u.xmp_sidecar)||!1,use_os_locale:(null==u?void 0:u.use_os_locale)||!1,album:(null==u?void 0:u.album)||"All Photos",library:(null==u?void 0:u.library)||"Personal Library",recent:(null==u?void 0:u.recent)||null,until_found:(null==u?void 0:u.until_found)||null,skip_videos:(null==u?void 0:u.skip_videos)||!1,skip_live_photos:(null==u?void 0:u.skip_live_photos)||!1,auto_delete:(null==u?void 0:u.auto_delete)||!1,delete_after_download:(null==u?void 0:u.delete_after_download)||!1,interval:(null==u?void 0:u.interval)||null,log_level:(null==u?void 0:u.log_level)||"info"});return(0,l.jsxs)(m.aF,{isOpen:o,onClose:i,isCentered:!0,motionPreset:"slideInBottom",size:"xl",scrollBehavior:"inside",children:[(0,l.jsx)(g.m,{backdropFilter:"blur(4px)"}),(0,l.jsxs)(f.$,{maxW:"800px",w:"90%",bg:"white",borderRadius:"2xl",boxShadow:"xl",children:[(0,l.jsx)(b.r,{fontFamily:"Inter, sans-serif",children:a?"Edit Policy":"New Policy"}),(0,l.jsx)(v.s,{}),(0,l.jsx)(_.c,{pb:6,children:(0,l.jsxs)(c.T,{spacing:4,align:"stretch",divider:(0,l.jsx)(t.a,{h:"1px",bg:"gray.100"}),children:[(0,l.jsxs)(t.a,{children:[(0,l.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Basic Settings"}),(0,l.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,l.jsx)(y.MJ,{isRequired:!0,children:(0,l.jsx)(R,{label:"Policy Name",info:"A unique name to identify this policy",children:(0,l.jsx)(C.p,{value:p.name,onChange:e=>O({...p,name:e.target.value}),maxW:"300px"})})}),(0,l.jsx)(y.MJ,{isRequired:!0,children:(0,l.jsx)(R,{label:"iCloud Username",info:"Your iCloud account email address",children:(0,l.jsx)(C.p,{value:p.username,onChange:e=>O({...p,username:e.target.value}),maxW:"300px"})})}),(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Domain",info:"The iCloud service domain to use",children:(0,l.jsxs)(w.l,{value:p.domain,onChange:e=>O({...p,domain:e.target.value}),maxW:"100px",children:[(0,l.jsx)("option",{value:"com",children:"com"}),(0,l.jsx)("option",{value:"cn",children:"cn"})]})})}),(0,l.jsx)(y.MJ,{isRequired:!0,children:(0,l.jsx)(R,{label:"Download Directory",info:"The local directory where photos will be downloaded",children:(0,l.jsx)(C.p,{value:p.directory,onChange:e=>O({...p,directory:e.target.value}),maxW:"300px"})})})]})]}),(0,l.jsxs)(t.a,{children:[(0,l.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Download Options"}),(0,l.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Folder Structure",info:"The folder structure pattern using Python's strftime format",children:(0,l.jsx)(C.p,{value:p.folder_structure,onChange:e=>O({...p,folder_structure:e.target.value}),maxW:"200px"})})}),(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Live Photo Size",info:"The size of live photos to download",children:(0,l.jsxs)(w.l,{value:p.live_photo_size,onChange:e=>O({...p,live_photo_size:e.target.value}),maxW:"150px",children:[(0,l.jsx)("option",{value:"original",children:"Original"}),(0,l.jsx)("option",{value:"medium",children:"Medium"}),(0,l.jsx)("option",{value:"thumb",children:"Thumb"})]})})}),(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Force Size",info:"Force a specific size when downloading photos",children:(0,l.jsx)(k.d,{checked:p.force_size,onChange:e=>O({...p,force_size:e.target.checked})})})}),(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Keep Unicode in Filenames",info:"Preserve Unicode characters in filenames instead of converting them",children:(0,l.jsx)(k.d,{checked:p.keep_unicode_in_filenames,onChange:e=>O({...p,keep_unicode_in_filenames:e.target.checked})})})}),(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Set EXIF Datetime",info:"Set the EXIF datetime in the downloaded photos",children:(0,l.jsx)(k.d,{checked:p.set_exif_datetime,onChange:e=>O({...p,set_exif_datetime:e.target.checked})})})}),(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"XMP Sidecar",info:"Create XMP sidecar files for the downloaded photos",children:(0,l.jsx)(k.d,{checked:p.xmp_sidecar,onChange:e=>O({...p,xmp_sidecar:e.target.checked})})})}),(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Use OS Locale",info:"Use the operating system's locale settings",children:(0,l.jsx)(k.d,{checked:p.use_os_locale,onChange:e=>O({...p,use_os_locale:e.target.checked})})})})]})]}),(0,l.jsxs)(t.a,{children:[(0,l.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Filter Options"}),(0,l.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Album",info:"The album to download from. Choose from a list of albums when the policy is authenticated. Note that user-created albums only exist in Personal Library and trying to download them from a Shared Library will result in an error. Default: All Photos",children:(null==u?void 0:u.authenticated)&&u.albums?(0,l.jsx)(w.l,{value:u.albums.includes(p.album)?p.album:"",onChange:e=>O({...p,album:e.target.value}),maxW:"200px",placeholder:"Select an album",children:u.albums.map(e=>(0,l.jsx)("option",{value:e,children:e},e))}):(0,l.jsx)(C.p,{value:p.album,onChange:e=>O({...p,album:e.target.value}),maxW:"200px",placeholder:"Enter album name"})})}),(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Library",info:"The library to download from. Personal Library will be used if you do not have a shared library. Default: Personal Library",children:(0,l.jsxs)(w.l,{value:p.library,onChange:e=>O({...p,library:e.target.value}),maxW:"200px",children:[(0,l.jsx)("option",{value:"Personal Library",children:"Personal Library"}),(0,l.jsx)("option",{value:"Shared Library",children:"Shared Library"})]})})}),(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Download Recents",info:"Number of recent photos to download (leave empty for all)",children:(0,l.jsx)(S.Q7,{value:p.recent||"",onChange:e=>O({...p,recent:""===e?null:parseInt(e)}),min:0,maxW:"100px",children:(0,l.jsx)(S.OO,{})})})}),(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Skip Videos",info:"Skip downloading video files",children:(0,l.jsx)(k.d,{checked:p.skip_videos,onChange:e=>O({...p,skip_videos:e.target.checked})})})}),(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Skip Live Photos",info:"Skip downloading live photos",children:(0,l.jsx)(k.d,{checked:p.skip_live_photos,onChange:e=>O({...p,skip_live_photos:e.target.checked})})})})]})]}),(0,l.jsxs)(t.a,{children:[(0,l.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Delete Options"}),(0,l.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Auto Delete",info:"Automatically delete photos that are no longer in iCloud",children:(0,l.jsx)(k.d,{checked:p.auto_delete,onChange:e=>O({...p,auto_delete:e.target.checked})})})}),(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Delete After Download",info:"Delete photos from iCloud after successful download",children:(0,l.jsx)(k.d,{checked:p.delete_after_download,onChange:e=>O({...p,delete_after_download:e.target.checked})})})})]})]}),(0,l.jsxs)(t.a,{children:[(0,l.jsx)(j.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"UI Options"}),(0,l.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Sync Interval (minutes)",info:"How often to automatically sync photos (leave empty for manual sync)",children:(0,l.jsx)(S.Q7,{value:p.interval||"",onChange:e=>O({...p,interval:""===e?null:parseInt(e)}),min:0,maxW:"100px",children:(0,l.jsx)(S.OO,{})})})}),(0,l.jsx)(y.MJ,{children:(0,l.jsx)(R,{label:"Log Level",info:"The level of detail in log messages",children:(0,l.jsxs)(w.l,{value:p.log_level,onChange:e=>O({...p,log_level:e.target.value}),maxW:"150px",children:[(0,l.jsx)("option",{value:"debug",children:"Debug"}),(0,l.jsx)("option",{value:"info",children:"Info"}),(0,l.jsx)("option",{value:"error",children:"Error"})]})})})]})]})]})}),(0,l.jsxs)(E.j,{children:[(0,l.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},mr:3,borderRadius:"xl",fontFamily:"Inter, sans-serif",onClick:()=>{if(!x)return;let e=a?"policies_after_save":"policies_after_create";x.once(e,e=>{h({title:"Success",description:'Policy "'.concat(p.name,'" ').concat(a?"saved":"created"," successfully"),status:"success",duration:3e3,isClosable:!0}),i(),s&&s(e)}),x.once(a?"error_saving_policy":"error_creating_policy",o=>{let{policy_name:i,error:l}=o;h({title:"Error",description:"Failed to ".concat(a?"save":"create",' policy "').concat(i,'": ').concat(l),status:"error",duration:5e3,isClosable:!0}),x.off(e)}),a?x.emit("savePolicy",null==u?void 0:u.name,p):x.emit("createPolicy",p)},children:"Save"}),(0,l.jsx)(d.$,{onClick:i,borderRadius:"xl",fontFamily:"Inter, sans-serif",variant:"ghost",_hover:{bg:"gray.100"},children:"Cancel"})]})]})]})}var A=i(1911);function M(e){let{isOpen:o,onClose:i,onConfirm:s,policyName:r}=e,t=(0,n.useRef)(null);return(0,l.jsx)(A.Lt,{isOpen:o,leastDestructiveRef:t,onClose:i,isCentered:!0,children:(0,l.jsx)(g.m,{children:(0,l.jsxs)(A.EO,{borderRadius:"xl",children:[(0,l.jsx)(b.r,{fontSize:"lg",fontWeight:"bold",children:"Delete Policy"}),(0,l.jsxs)(_.c,{children:['Are you sure you want to delete policy "',r,'"? This action cannot be undone.']}),(0,l.jsxs)(E.j,{children:[(0,l.jsx)(d.$,{ref:t,onClick:i,borderRadius:"xl",children:"Cancel"}),(0,l.jsx)(d.$,{colorScheme:"red",onClick:()=>{s(),i()},ml:3,borderRadius:"xl",children:"Delete"})]})]})})})}var L=i(2533),W=i(5442);function I(){return(0,l.jsx)(t.a,{bg:"white",borderBottom:"1px",borderColor:"gray.200",py:4,position:"sticky",top:0,zIndex:1,children:(0,l.jsx)(t.a,{mx:"auto",width:"100%",children:(0,l.jsxs)(L.s,{maxW:"container.xl",mx:"auto",width:"100%",justify:"space-between",align:"center",children:[(0,l.jsx)(W.D,{fontSize:"24px",fontWeight:"bold",fontFamily:"Inter, sans-serif",color:"black",children:"iCloud Photos Downloader"}),(0,l.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},borderRadius:"xl",fontFamily:"Inter, sans-serif",fontSize:"14px",children:"Settings"})]})})})}var T=i(1683);function J(e){let{title:o,children:i,headerRight:n,...s}=e;return(0,l.jsx)(t.a,{width:"100%",...s,children:(0,l.jsxs)(t.a,{bg:"white",borderRadius:"2xl",boxShadow:"sm",border:"1px",borderColor:"gray.200",display:"flex",flexDirection:"column",children:[(0,l.jsxs)(L.s,{px:6,py:4,borderBottom:"1px",borderColor:"gray.100",height:"56px",alignItems:"center",children:[(0,l.jsx)(j.E,{fontSize:"12px",fontWeight:"bold",color:"gray.500",letterSpacing:"0.05em",children:o.toUpperCase()}),(0,l.jsx)(T.h,{}),n]}),(0,l.jsx)(t.a,{pt:2,pb:10,px:12,flex:"1",minH:"200px",display:"flex",alignItems:"flex-start",width:"100%",children:i})]})})}var $=i(206),U=i(1889),K=i(4893),q=i(4605),N=i(6317),B=i(6434),H=i(6344),X=i(921),Y=i(1536);let V=e=>{let{isOpen:o,onClose:i,onConfirm:s,policyName:r}=e,t=(0,n.useRef)(null);return(0,l.jsx)(A.Lt,{isOpen:o,leastDestructiveRef:t,onClose:i,children:(0,l.jsx)(g.m,{children:(0,l.jsxs)(A.EO,{children:[(0,l.jsx)(b.r,{fontSize:"lg",fontWeight:"bold",children:"Interrupt Download"}),(0,l.jsxs)(_.c,{children:["Are you sure you want to interrupt the policy ",r,"? All downloaded files will be kept."]}),(0,l.jsxs)(E.j,{children:[(0,l.jsx)(d.$,{ref:t,onClick:i,children:"Cancel"}),(0,l.jsx)(d.$,{colorScheme:"red",onClick:s,ml:3,children:"Confirm"})]})]})})})},Q=e=>{let{policy:o,setPolicies:i,onEdit:r,onDelete:a,onRun:c,onInterrupt:u,socket:x,toast:m}=e,{isOpen:g,onToggle:f}=(0,s.j)(),{isOpen:b,onOpen:v,onClose:_}=(0,s.j)(),[y,C]=(0,n.useState)(!1);(0,n.useEffect)(()=>{"running"===o.status&&C(!1)},[o.status]);let w=(e=>"running"===e.status?{text:"running",color:"blue.500"}:"errored"===e.status?{text:"errored",color:"red.500"}:e.authenticated?100===e.progress?{text:"done",color:"green.500"}:{text:"ready",color:"green.500"}:{text:"unauthenticated",color:"gray.500"})(o);return(0,l.jsxs)(t.a,{width:"100%",borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:[(0,l.jsxs)(L.s,{p:4,justify:"space-between",align:"center",bg:g?"gray.50":"white",onClick:f,cursor:"pointer",_hover:{bg:"gray.50"},children:[(0,l.jsxs)(L.s,{flex:1,gap:4,children:[(0,l.jsx)(h.K,{"aria-label":"Expand row",icon:g?(0,l.jsx)(O.M,{}):(0,l.jsx)(z.D,{}),variant:"ghost",size:"sm"}),(0,l.jsxs)(t.a,{flex:1,children:[(0,l.jsx)(j.E,{fontSize:"16px",fontWeight:"medium",children:o.name}),(0,l.jsxs)(L.s,{gap:2,color:"gray.500",fontSize:"14px",children:[(0,l.jsx)(j.E,{color:w.color,fontWeight:"medium",children:w.text}),(0,l.jsx)(j.E,{children:"•"}),(0,l.jsx)(j.E,{children:o.username}),(0,l.jsx)(j.E,{children:"•"}),(0,l.jsx)(j.E,{children:o.directory})]})]}),(0,l.jsx)(t.a,{width:"150px",display:"flex",children:(0,l.jsxs)(t.a,{flex:"1",mt:1,children:[(0,l.jsx)(j.E,{fontSize:"12px",color:"gray.600",fontWeight:"medium",children:"running"===o.status?"".concat(o.progress||0,"%"):"IDLE"}),(0,l.jsx)(q.k,{value:o.progress||0,size:"sm",colorScheme:"running"===o.status?"blue":"errored"===o.status?"red":"green",borderRadius:"full"})]})})]}),(0,l.jsxs)(L.s,{gap:2,ml:4,children:[y?(0,l.jsx)(h.K,{"aria-label":"Loading",icon:(0,l.jsx)(K.y,{size:"sm"}),colorScheme:"blue",variant:"ghost",size:"sm"}):"running"===o.status?(0,l.jsx)(h.K,{"aria-label":"Pause download",icon:(0,l.jsx)(Y.kwt,{}),colorScheme:"blue",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),v()}}):(0,l.jsx)(h.K,{"aria-label":"Run policy",icon:(0,l.jsx)(Y.gSK,{}),colorScheme:"green",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),x&&o.authenticated&&(C(!0),x.once("icloud_is_busy",()=>{C(!1)}),x.once("download_failed",()=>{C(!1)})),c(o)}}),(0,l.jsx)(h.K,{"aria-label":"Edit policy",icon:(0,l.jsx)(N.q,{}),colorScheme:"blue",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),r(o)},isDisabled:"running"===o.status}),(0,l.jsx)(h.K,{"aria-label":"Duplicate policy",icon:(0,l.jsx)(B.T,{}),colorScheme:"blue",variant:"ghost",size:"sm",onClick:e=>{if(e.stopPropagation(),!x)return;let l={...o,name:"".concat(o.name," COPY"),authenticated:!1};x.once("policies_after_create",e=>{i(e)}),x.once("error_creating_policy",e=>{let{policy_name:o,error:i}=e;m({title:"Error",description:'Failed to create policy "'.concat(o,'": ').concat(i),status:"error",duration:5e3,isClosable:!0})}),x.emit("createPolicy",l)},isDisabled:"running"===o.status}),(0,l.jsx)(h.K,{"aria-label":"Delete policy",icon:(0,l.jsx)(H.d,{}),colorScheme:"red",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),a(o)},isDisabled:"running"===o.status})]})]}),(0,l.jsx)(V,{isOpen:b,onClose:_,onConfirm:()=>{u(o),_()},policyName:o.name}),(0,l.jsx)(p.S,{in:g,children:(0,l.jsxs)(t.a,{p:4,bg:"gray.50",children:[(0,l.jsx)(t.a,{ml:12,maxH:"300px",overflowY:"auto",sx:{"&::-webkit-scrollbar":{width:"8px",borderRadius:"8px",backgroundColor:"rgba(0, 0, 0, 0.05)"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0, 0, 0, 0.1)",borderRadius:"8px","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.15)"}}},children:(0,l.jsx)(j.E,{fontSize:"14px",fontFamily:"monospace",whiteSpace:"pre-wrap",sx:{wordBreak:"break-word"},children:o.logs||"No logs available"})}),o.logs&&"running"!==o.status&&(0,l.jsx)(L.s,{justify:"flex-start",mt:4,ml:12,children:(0,l.jsx)(d.$,{leftIcon:(0,l.jsx)(X.s,{}),size:"sm",variant:"outline",colorScheme:"blue",onClick:e=>{if(e.stopPropagation(),!o.logs)return;let i=new Blob([o.logs],{type:"text/plain"}),l=URL.createObjectURL(i),n=document.createElement("a");n.href=l,n.download="".concat(o.name,"-logs.txt"),document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l)},children:"Export Logs"})})]})})]})},Z=e=>{let{isOpen:o,onClose:i,onImport:n}=e;return(0,l.jsxs)(m.aF,{isOpen:o,onClose:i,children:[(0,l.jsx)(g.m,{}),(0,l.jsxs)(f.$,{children:[(0,l.jsx)(b.r,{children:"Import Policies"}),(0,l.jsx)(v.s,{}),(0,l.jsx)(_.c,{children:(0,l.jsx)(j.E,{children:"Select a TOML file containing policy definitions to import."})}),(0,l.jsx)(E.j,{children:(0,l.jsx)(d.$,{colorScheme:"blue",onClick:n,children:"Choose File"})})]})]})},G=e=>{let{isOpen:o,onClose:i,onExport:n}=e;return(0,l.jsxs)(m.aF,{isOpen:o,onClose:i,children:[(0,l.jsx)(g.m,{}),(0,l.jsxs)(f.$,{children:[(0,l.jsx)(b.r,{children:"Export Policies"}),(0,l.jsx)(v.s,{}),(0,l.jsx)(_.c,{children:(0,l.jsx)(j.E,{children:"Download your policies as a TOML file."})}),(0,l.jsx)(E.j,{children:(0,l.jsx)(d.$,{colorScheme:"blue",onClick:n,children:"Download"})})]})]})};var ee=i(8613),eo=i(5184),ei=i(9616),el=i(2863),en=i(1741),es=i(3129),er=i(9365),et=i(6152),ea=i(6084);let ec=e=>{let{selectedUsernames:o,setSelectedUsernames:i,uniqueUsernames:n}=e;return(0,l.jsxs)(ee.W,{children:[(0,l.jsx)(eo.I,{as:h.K,"aria-label":"Filter policies",icon:(0,l.jsx)(et.R,{}),variant:"ghost",colorScheme:"gray"}),(0,l.jsx)(ei.c,{children:(0,l.jsx)(t.a,{px:4,py:2,children:(0,l.jsx)(el.$,{value:o,onChange:e=>i(e),children:(0,l.jsxs)(en.B,{children:[(0,l.jsx)(es.S,{value:"All",onChange:e=>{e.target.checked?i(["All"]):i([])},children:"All"}),n.map(e=>(0,l.jsx)(es.S,{value:e,isChecked:o.includes(e),onChange:l=>{l.target.checked?o.includes("All")?i([e]):i([...o,e]):i(o.filter(o=>o!==e))},children:e},e))]})})})})]})},ed=e=>{let{setSortOrder:o}=e;return(0,l.jsxs)(ee.W,{children:[(0,l.jsx)(eo.I,{as:h.K,"aria-label":"Sort policies",icon:(0,l.jsx)(ea.Dwj,{}),variant:"ghost",colorScheme:"gray"}),(0,l.jsxs)(ei.c,{children:[(0,l.jsx)(er.D,{onClick:()=>o("asc"),children:"Name: A to Z"}),(0,l.jsx)(er.D,{onClick:()=>o("desc"),children:"Name: Z to A"})]})]})},eu=e=>{let{policies:o,setPolicies:i,onEdit:r,onDelete:a,onRun:d,onInterrupt:u,socket:x,toast:p}=e,[m,g]=(0,n.useState)(o),[f,b]=(0,n.useState)(["All"]),[v,_]=(0,n.useState)("none"),y=(0,n.useRef)(null),{isOpen:C,onOpen:w,onClose:k}=(0,s.j)(),{isOpen:S,onOpen:E,onClose:O}=(0,s.j)(),z=Array.from(new Set(o.map(e=>e.username)));(0,n.useEffect)(()=>{let e=[...o];f.includes("All")||(e=e.filter(e=>f.includes(e.username))),"none"!==v&&e.sort((e,o)=>"asc"===v?e.name.localeCompare(o.name):o.name.localeCompare(e.name)),g(e)},[o,f,v]);let D=async e=>{var o;let l=null===(o=e.target.files)||void 0===o?void 0:o[0];if(!l||!x)return;let n=await l.text();x.emit("uploadPolicies",n),x.once("uploaded_policies",e=>{i(e),p({title:"Success",description:"Policies imported successfully",status:"success",duration:3e3,isClosable:!0})}),x.once("error_uploading_policies",e=>{let{error:o}=e;p({title:"Error",description:"Failed to import policies: ".concat(o),status:"error",duration:5e3,isClosable:!0})}),k(),y.current&&(y.current.value="")};return(0,l.jsxs)(c.T,{spacing:2,width:"100%",align:"stretch",children:[(0,l.jsxs)(L.s,{justify:"space-between",gap:2,children:[(0,l.jsxs)(L.s,{gap:2,children:[(0,l.jsx)("input",{type:"file",ref:y,onChange:D,accept:".toml",style:{display:"none"}}),(0,l.jsx)(h.K,{"aria-label":"Import policies",icon:(0,l.jsx)($.ekc,{}),onClick:w,variant:"ghost",colorScheme:"gray"}),(0,l.jsx)(h.K,{"aria-label":"Export policies",icon:(0,l.jsx)(U.bOW,{}),onClick:E,variant:"ghost",colorScheme:"gray"})]}),(0,l.jsxs)(L.s,{gap:2,children:[(0,l.jsx)(ec,{selectedUsernames:f,setSelectedUsernames:b,uniqueUsernames:z}),(0,l.jsx)(ed,{setSortOrder:_})]})]}),(0,l.jsx)(Z,{isOpen:C,onClose:k,onImport:()=>{var e;null===(e=y.current)||void 0===e||e.click()}}),(0,l.jsx)(G,{isOpen:S,onClose:O,onExport:()=>{x&&(x.emit("downloadPolicies"),x.once("error_downloading_policies",e=>{let{error:o}=e;p({title:"Error",description:"Failed to export policies: ".concat(o),status:"error",duration:5e3,isClosable:!0})}),x.once("downloaded_policies",e=>{let o=new Blob([e],{type:"text/plain"}),i=URL.createObjectURL(o),l=document.createElement("a");l.href=i,l.download="policies.toml",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(i),O()}))}}),m.length>0?m.map(e=>(0,l.jsx)(Q,{policy:e,setPolicies:i,onEdit:r,onDelete:a,onRun:d,onInterrupt:u,socket:x,toast:p},e.name)):(0,l.jsx)(t.a,{height:"100px",display:"grid",placeItems:"center",children:(0,l.jsx)(j.E,{color:"gray.500",textAlign:"center",fontFamily:"Inter, sans-serif",fontSize:"14px",children:"No policies found"})})]})};var eh=i(7511),ex=i(6758),ep=i(4895),ej=i(6742);function em(e){let{isOpen:o,onClose:i,onSubmit:s,username:r,socket:t}=e,[a,c]=(0,n.useState)(""),[u,p]=(0,n.useState)(!1),[v,w]=(0,n.useState)(!1),k=()=>{t&&(w(!0),t.once("authenticated",()=>{w(!1),i()}),t.once("authentication_failed",()=>{w(!1)}),s(a),c(""))};return(0,l.jsxs)(m.aF,{isOpen:o,onClose:i,isCentered:!0,children:[(0,l.jsx)(g.m,{backdropFilter:"blur(4px)"}),(0,l.jsxs)(f.$,{borderRadius:"xl",children:[(0,l.jsx)(b.r,{children:"Authentication Required"}),(0,l.jsx)(_.c,{children:(0,l.jsxs)(y.MJ,{children:[(0,l.jsx)(x.l,{children:v?(0,l.jsx)(L.s,{gap:2,align:"center",children:(0,l.jsx)(j.E,{children:"Authenticating..."})}):"Enter the password for iCloud user ".concat(r)}),(0,l.jsxs)(eh.M,{children:[(0,l.jsx)(C.p,{type:u?"text":"password",value:a,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"===e.key&&a&&k()}}),(0,l.jsx)(ex.t,{children:(0,l.jsx)(h.K,{"aria-label":u?"Hide password":"Show password",icon:u?(0,l.jsx)(ep.O,{}):(0,l.jsx)(ej.t,{}),variant:"ghost",onClick:()=>p(!u),size:"sm"})})]})]})}),(0,l.jsxs)(E.j,{children:[(0,l.jsx)(d.$,{variant:"ghost",mr:3,onClick:i,children:"Cancel"}),(0,l.jsx)(d.$,{colorScheme:"blue",onClick:k,isDisabled:!a||v,isLoading:v,children:"Submit"})]})]})]})}function eg(e){let{isOpen:o,onClose:i,onSubmit:s,error:r,socket:t}=e,[a,u]=(0,n.useState)(""),[h,p]=(0,n.useState)(!1),v=()=>{t&&(p(!0),t.once("authenticated",()=>{p(!1),i()}),t.once("authentication_failed",()=>{p(!1)}),t.once("mfa_required",()=>{p(!1)}),s(a),u(""))};return(0,l.jsxs)(m.aF,{isOpen:o,onClose:i,isCentered:!0,children:[(0,l.jsx)(g.m,{backdropFilter:"blur(4px)"}),(0,l.jsxs)(f.$,{borderRadius:"xl",children:[(0,l.jsx)(b.r,{children:"Two-Factor Authentication"}),(0,l.jsx)(_.c,{children:(0,l.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,l.jsxs)(y.MJ,{children:[(0,l.jsx)(x.l,{children:h?(0,l.jsx)(L.s,{gap:2,align:"center",children:(0,l.jsx)(j.E,{children:"Verifying..."})}):"Verification code is sent to your trusted devices"}),(0,l.jsx)(C.p,{type:"text",value:a,onChange:e=>u(e.target.value),onKeyDown:e=>{"Enter"===e.key&&a&&v()},placeholder:"Enter code",isDisabled:h})]}),r&&(0,l.jsx)(j.E,{color:"red.500",fontSize:"sm",children:r})]})}),(0,l.jsxs)(E.j,{children:[(0,l.jsx)(d.$,{variant:"ghost",mr:3,onClick:i,isDisabled:h,children:"Cancel"}),(0,l.jsx)(d.$,{colorScheme:"blue",onClick:v,isDisabled:!a||h,isLoading:h,children:"Submit"})]})]})]})}function ef(){let[e,o]=(0,n.useState)([]),[i,u]=(0,n.useState)(),[h,x]=(0,n.useState)(),[p,j]=(0,n.useState)(),[m,g]=(0,n.useState)(),{isOpen:f,onOpen:b,onClose:v}=(0,s.j)(),{isOpen:_,onOpen:y,onClose:C}=(0,s.j)(),{isOpen:w,onOpen:k,onClose:S}=(0,s.j)(),{isOpen:E,onOpen:O,onClose:z}=(0,s.j)(),D=P(),R=(0,r.d)();!function(e){let{socket:o,toast:i,setPolicies:l}=e;(0,n.useEffect)(()=>{if(!o)return;o.emit("getPolicies");let e=["policies","policies_after_save","policies_after_delete"];e.forEach(e=>{o.on(e,o=>{l(o),"policies"!==e&&i({title:"Success",description:{policies_after_save:"Policy saved successfully",policies_after_delete:"Policy deleted successfully"}[e],status:"success",duration:3e3,isClosable:!0})})});let n={connect_error:"Failed to connect to server",error_saving_policy:"Failed to save policy",error_deleting_policy:"Failed to delete policy",error_interrupting_download:"Failed to interrupt download",authentication_failed:"Authentication failed"};Object.entries(n).forEach(e=>{let[l,n]=e;o.on(l,e=>{let o=(null==e?void 0:e.error)||(null==e?void 0:e.message)||"",l=(null==e?void 0:e.policy_name)?' "'.concat(e.policy_name,'"'):"";i({title:"Error",description:"".concat(n).concat(l).concat(o?": "+o:""),status:"error",duration:5e3,isClosable:!0})})}),o.on("download_failed",e=>{let{policy:o,error:l,logs:n}=e;s(o),n&&r(o.name,n),i({title:"Error",description:'Error downloading photos for policy "'.concat(o.name,'": ').concat(l),status:"error",duration:5e3,isClosable:!0})}),o.on("authenticated",e=>{let{msg:o,policies:n}=e;i({title:"Authentication Successful",description:o,status:"success",duration:3e3,isClosable:!0}),l(n)}),o.on("mfa_required",e=>{i({title:"MFA Required",description:e,status:"info",duration:3e3,isClosable:!0})}),o.on("icloud_is_busy",e=>{i({title:"iCloud Account Busy",description:e,status:"info",duration:5e3,isClosable:!0})});let s=e=>{l(o=>o.map(o=>o.name===e.name?{...o,...e}:o))},r=(e,o)=>{l(i=>i.map(i=>i.name===e?{...i,logs:(i.logs||"")+o}:i))};return o.on("download_progress",e=>{let{policy:o,logs:i}=e;s(o),i&&r(o.name,i)}),o.on("download_finished",e=>{let{policy_name:o,progress:l,logs:n}=e;s({name:o,progress:l,status:"stopped"}),n&&r(o,n),i({title:"Download Complete",description:'Successfully downloaded photos for policy "'.concat(o,'"'),status:"success",duration:5e3,isClosable:!0})}),()=>{e.forEach(e=>o.off(e)),Object.keys(n).forEach(e=>o.off(e)),o.off("authenticated"),o.off("mfa_required"),o.off("download_progress"),o.off("download_finished"),o.off("download_failed"),o.off("icloud_is_busy")}},[o,i,l])}({socket:D,toast:R,setPolicies:o}),(0,n.useEffect)(()=>{if(!D)return;let e=()=>{S(),z()},o=e=>{S(),g(e),O()};return D.on("authenticated",e),D.on("mfa_required",o),()=>{D.off("authenticated",e),D.off("mfa_required",o)}},[D,p,S,z,O]);let A=()=>{u(void 0),v()};return(0,l.jsxs)(t.a,{bg:"gray.200",minH:"100vh",children:[(0,l.jsx)(I,{}),(0,l.jsxs)(a.m,{maxW:"container.xl",py:8,children:[(0,l.jsx)(c.T,{spacing:8,align:"center",width:"100%",children:(0,l.jsx)(t.a,{width:"100%",children:(0,l.jsx)(J,{title:"All Policies",headerRight:(0,l.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},borderRadius:"xl",fontFamily:"Inter, sans-serif",fontSize:"12px",size:"sm",px:4,pt:1,onClick:()=>{u(void 0),b()},children:"Add"}),children:(0,l.jsx)(eu,{policies:e,setPolicies:o,onEdit:e=>{u(e),b()},onDelete:e=>{x(e),y()},onRun:e=>{D&&(e.authenticated?(e.logs="",D.emit("start",e.name)):(j(e),k()))},onInterrupt:e=>{D&&D.emit("interrupt",e.name)},socket:D,toast:R})})})}),f&&(0,l.jsx)(F,{isOpen:!0,onClose:A,onPolicySaved:e=>{o(e),A()},isEditing:!!i,policy:i}),_&&(0,l.jsx)(M,{isOpen:_,onClose:C,onConfirm:()=>{h&&(null==D||D.emit("deletePolicy",h.name),C(),x(void 0))},policyName:(null==h?void 0:h.name)||""}),w&&(0,l.jsx)(em,{isOpen:!0,onClose:()=>{S(),j(void 0)},onSubmit:e=>{D&&p&&D.emit("authenticate",p.name,e)},username:(null==p?void 0:p.username)||"",socket:D}),E&&(0,l.jsx)(eg,{isOpen:!0,onClose:()=>{z(),j(void 0),g(void 0)},onSubmit:e=>{D&&p&&(g(void 0),D.emit("provideMFA",p.name,e))},error:m,socket:D})]})]})}}},e=>{var o=o=>e(e.s=o);e.O(0,[897,506,711,873,647,524,441,517,358],()=>o(4180)),_N_E=e.O()}]);