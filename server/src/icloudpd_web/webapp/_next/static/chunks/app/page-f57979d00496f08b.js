(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4180:(e,o,i)=>{Promise.resolve().then(i.bind(i,5801))},5801:(e,o,i)=>{"use strict";i.r(o),i.d(o,{default:()=>ei});var n=i(5155),l=i(2115),r=i(3166),s=i(3085),t=i(9949),a=i(5389),c=i(3420),d=i(9829),u=i(674),h=i(2403),x=i(4462),p=i(2369),f=i(3083),g=i(6677),m=i(2311),j=i(5477),b=i(4999),_=i(4825),v=i(7504),y=i(4619),C=i(7389),w=i(863),k=i(726),S=i(5946),E=i(4681),z=i(3031),D=i(3792),P=i(1319);function O(){let[e,o]=(0,l.useState)(null);return(0,l.useEffect)(()=>{console.log("Attempting to connect to WebSocket server...");let e=(0,P.io)("/",{transports:["websocket"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,auth:{clientId:"default-user"}});return e.on("connect",()=>{console.log("Connected to Python server")}),e.on("connect_error",e=>{console.error("Socket connection error:",e.message)}),e.on("disconnect",e=>{console.log("Socket disconnected:",e)}),["policies","uploaded_policies","policies_after_save","policies_after_delete"].forEach(o=>{e.on(o,e=>{console.log("".concat(o,":"),e)})}),["error_saving_policy","error_deleting_policy","error_interrupting_download"].forEach(o=>{e.on(o,e=>{console.error("".concat(o,":"),e)})}),e.on("authenticated",e=>{console.log("Authentication successful:",e)}),e.on("authentication_failed",e=>{console.error("Authentication failed:",e)}),e.on("mfa_required",e=>{console.log("MFA required:",e)}),e.on("download_progress",e=>{console.log("Download progress:",e)}),e.on("download_finished",e=>{console.log("Download finished:",e)}),e.on("download_failed",e=>{console.error("Download failed:",e)}),o(e),()=>{console.log("Cleaning up socket connection"),e.close()}},[]),e}function F(e){let{label:o,info:i,children:l}=e,{isOpen:s,onToggle:a}=(0,r.j)();return(0,n.jsxs)(t.a,{children:[(0,n.jsxs)(u.z,{spacing:2,align:"center",mb:i&&s?2:0,children:[(0,n.jsx)(h.K,{"aria-label":"Toggle info",icon:s?(0,n.jsx)(z.M,{}):(0,n.jsx)(D.D,{}),size:"sm",variant:"ghost",onClick:a}),(0,n.jsx)(x.l,{flex:"1",mb:"0",children:o}),l]}),i&&(0,n.jsx)(p.S,{in:s,children:(0,n.jsx)(t.a,{pl:10,pr:4,py:2,bg:"gray.50",borderRadius:"md",children:(0,n.jsx)(f.E,{fontSize:"sm",color:"gray.600",children:i})})})]})}function M(e){let{isOpen:o,onClose:i,onPolicySaved:r,isEditing:a=!1,policy:u}=e,h=(0,s.d)(),x=O(),[p,z]=(0,l.useState)({name:(null==u?void 0:u.name)||"",username:(null==u?void 0:u.username)||"",directory:(null==u?void 0:u.directory)||"",domain:(null==u?void 0:u.domain)||"com",folder_structure:(null==u?void 0:u.folder_structure)||"{:%Y/%m/%d}",size:(null==u?void 0:u.size)||["original"],live_photo_size:(null==u?void 0:u.live_photo_size)||"original",force_size:(null==u?void 0:u.force_size)||!1,align_raw:(null==u?void 0:u.align_raw)||"original",keep_unicode_in_filenames:(null==u?void 0:u.keep_unicode_in_filenames)||!1,set_exif_datetime:(null==u?void 0:u.set_exif_datetime)||!1,live_photo_mov_filename_policy:(null==u?void 0:u.live_photo_mov_filename_policy)||"suffix",file_match_policy:(null==u?void 0:u.file_match_policy)||"name-size-dedup-with-suffix",xmp_sidecar:(null==u?void 0:u.xmp_sidecar)||!1,use_os_locale:(null==u?void 0:u.use_os_locale)||!1,album:(null==u?void 0:u.album)||"All Photos",library:(null==u?void 0:u.library)||"Personal Library",recent:(null==u?void 0:u.recent)||null,until_found:(null==u?void 0:u.until_found)||null,skip_videos:(null==u?void 0:u.skip_videos)||!1,skip_live_photos:(null==u?void 0:u.skip_live_photos)||!1,auto_delete:(null==u?void 0:u.auto_delete)||!1,delete_after_download:(null==u?void 0:u.delete_after_download)||!1,interval:(null==u?void 0:u.interval)||null,log_level:(null==u?void 0:u.log_level)||"info"});return(0,n.jsxs)(g.aF,{isOpen:o,onClose:i,isCentered:!0,motionPreset:"slideInBottom",size:"xl",scrollBehavior:"inside",children:[(0,n.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,n.jsxs)(j.$,{maxW:"800px",w:"90%",bg:"white",borderRadius:"2xl",boxShadow:"xl",children:[(0,n.jsx)(b.r,{fontFamily:"Inter, sans-serif",children:a?"Edit Policy":"New Policy"}),(0,n.jsx)(_.s,{}),(0,n.jsx)(v.c,{pb:6,children:(0,n.jsxs)(c.T,{spacing:4,align:"stretch",divider:(0,n.jsx)(t.a,{h:"1px",bg:"gray.100"}),children:[(0,n.jsxs)(t.a,{children:[(0,n.jsx)(f.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Basic Settings"}),(0,n.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,n.jsx)(y.MJ,{isRequired:!0,children:(0,n.jsx)(F,{label:"Policy Name",info:"A unique name to identify this policy",children:(0,n.jsx)(C.p,{value:p.name,onChange:e=>z({...p,name:e.target.value}),maxW:"300px"})})}),(0,n.jsx)(y.MJ,{isRequired:!0,children:(0,n.jsx)(F,{label:"iCloud Username",info:"Your iCloud account email address",children:(0,n.jsx)(C.p,{value:p.username,onChange:e=>z({...p,username:e.target.value}),maxW:"300px"})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Domain",info:"The iCloud service domain to use",children:(0,n.jsxs)(w.l,{value:p.domain,onChange:e=>z({...p,domain:e.target.value}),maxW:"100px",children:[(0,n.jsx)("option",{value:"com",children:"com"}),(0,n.jsx)("option",{value:"cn",children:"cn"})]})})}),(0,n.jsx)(y.MJ,{isRequired:!0,children:(0,n.jsx)(F,{label:"Download Directory",info:"The local directory where photos will be downloaded",children:(0,n.jsx)(C.p,{value:p.directory,onChange:e=>z({...p,directory:e.target.value}),maxW:"300px"})})})]})]}),(0,n.jsxs)(t.a,{children:[(0,n.jsx)(f.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Download Options"}),(0,n.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Folder Structure",info:"The folder structure pattern using Python's strftime format",children:(0,n.jsx)(C.p,{value:p.folder_structure,onChange:e=>z({...p,folder_structure:e.target.value}),maxW:"200px"})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Live Photo Size",info:"The size of live photos to download",children:(0,n.jsxs)(w.l,{value:p.live_photo_size,onChange:e=>z({...p,live_photo_size:e.target.value}),maxW:"150px",children:[(0,n.jsx)("option",{value:"original",children:"Original"}),(0,n.jsx)("option",{value:"medium",children:"Medium"}),(0,n.jsx)("option",{value:"thumb",children:"Thumb"})]})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Force Size",info:"Force a specific size when downloading photos",children:(0,n.jsx)(k.d,{checked:p.force_size,onChange:e=>z({...p,force_size:e.target.checked})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Keep Unicode in Filenames",info:"Preserve Unicode characters in filenames instead of converting them",children:(0,n.jsx)(k.d,{checked:p.keep_unicode_in_filenames,onChange:e=>z({...p,keep_unicode_in_filenames:e.target.checked})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Set EXIF Datetime",info:"Set the EXIF datetime in the downloaded photos",children:(0,n.jsx)(k.d,{checked:p.set_exif_datetime,onChange:e=>z({...p,set_exif_datetime:e.target.checked})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"XMP Sidecar",info:"Create XMP sidecar files for the downloaded photos",children:(0,n.jsx)(k.d,{checked:p.xmp_sidecar,onChange:e=>z({...p,xmp_sidecar:e.target.checked})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Use OS Locale",info:"Use the operating system's locale settings",children:(0,n.jsx)(k.d,{checked:p.use_os_locale,onChange:e=>z({...p,use_os_locale:e.target.checked})})})})]})]}),(0,n.jsxs)(t.a,{children:[(0,n.jsx)(f.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Filter Options"}),(0,n.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Album",info:"The album to download from. Choose from a list of albums when the policy is authenticated. Note that user-created albums only exist in Personal Library and trying to download them from a Shared Library will result in an error. Default: All Photos",children:(null==u?void 0:u.authenticated)&&u.albums?(0,n.jsx)(w.l,{value:u.albums.includes(p.album)?p.album:"",onChange:e=>z({...p,album:e.target.value}),maxW:"200px",placeholder:"Select an album",children:u.albums.map(e=>(0,n.jsx)("option",{value:e,children:e},e))}):(0,n.jsx)(C.p,{value:p.album,onChange:e=>z({...p,album:e.target.value}),maxW:"200px",placeholder:"Enter album name"})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Library",info:"The library to download from. Personal Library will be used if you do not have a shared library. Default: Personal Library",children:(0,n.jsxs)(w.l,{value:p.library,onChange:e=>z({...p,library:e.target.value}),maxW:"200px",children:[(0,n.jsx)("option",{value:"Personal Library",children:"Personal Library"}),(0,n.jsx)("option",{value:"Shared Library",children:"Shared Library"})]})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Download Recents",info:"Number of recent photos to download (leave empty for all)",children:(0,n.jsx)(S.Q7,{value:p.recent||"",onChange:e=>z({...p,recent:""===e?null:parseInt(e)}),min:0,maxW:"100px",children:(0,n.jsx)(S.OO,{})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Skip Videos",info:"Skip downloading video files",children:(0,n.jsx)(k.d,{checked:p.skip_videos,onChange:e=>z({...p,skip_videos:e.target.checked})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Skip Live Photos",info:"Skip downloading live photos",children:(0,n.jsx)(k.d,{checked:p.skip_live_photos,onChange:e=>z({...p,skip_live_photos:e.target.checked})})})})]})]}),(0,n.jsxs)(t.a,{children:[(0,n.jsx)(f.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"Delete Options"}),(0,n.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Auto Delete",info:"Automatically delete photos that are no longer in iCloud",children:(0,n.jsx)(k.d,{checked:p.auto_delete,onChange:e=>z({...p,auto_delete:e.target.checked})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Delete After Download",info:"Delete photos from iCloud after successful download",children:(0,n.jsx)(k.d,{checked:p.delete_after_download,onChange:e=>z({...p,delete_after_download:e.target.checked})})})})]})]}),(0,n.jsxs)(t.a,{children:[(0,n.jsx)(f.E,{fontSize:"lg",fontWeight:"semibold",mb:4,children:"UI Options"}),(0,n.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Sync Interval (minutes)",info:"How often to automatically sync photos (leave empty for manual sync)",children:(0,n.jsx)(S.Q7,{value:p.interval||"",onChange:e=>z({...p,interval:""===e?null:parseInt(e)}),min:0,maxW:"100px",children:(0,n.jsx)(S.OO,{})})})}),(0,n.jsx)(y.MJ,{children:(0,n.jsx)(F,{label:"Log Level",info:"The level of detail in log messages",children:(0,n.jsxs)(w.l,{value:p.log_level,onChange:e=>z({...p,log_level:e.target.value}),maxW:"150px",children:[(0,n.jsx)("option",{value:"debug",children:"Debug"}),(0,n.jsx)("option",{value:"info",children:"Info"}),(0,n.jsx)("option",{value:"error",children:"Error"})]})})})]})]})]})}),(0,n.jsxs)(E.j,{children:[(0,n.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},mr:3,borderRadius:"xl",fontFamily:"Inter, sans-serif",onClick:()=>{if(!x)return;let e=a?"policies_after_save":"policies_after_create";x.once(e,e=>{h({title:"Success",description:'Policy "'.concat(p.name,'" ').concat(a?"saved":"created"," successfully"),status:"success",duration:3e3,isClosable:!0}),i(),r&&r(e)}),x.once(a?"error_saving_policy":"error_creating_policy",o=>{let{policy_name:i,error:n}=o;h({title:"Error",description:"Failed to ".concat(a?"save":"create",' policy "').concat(i,'": ').concat(n),status:"error",duration:5e3,isClosable:!0}),x.off(e)}),a?x.emit("savePolicy",null==u?void 0:u.name,p):x.emit("createPolicy",p)},children:"Save"}),(0,n.jsx)(d.$,{onClick:i,borderRadius:"xl",fontFamily:"Inter, sans-serif",variant:"ghost",_hover:{bg:"gray.100"},children:"Cancel"})]})]})]})}var R=i(1911);function W(e){let{isOpen:o,onClose:i,onConfirm:r,policyName:s}=e,t=(0,l.useRef)(null);return(0,n.jsx)(R.Lt,{isOpen:o,leastDestructiveRef:t,onClose:i,isCentered:!0,children:(0,n.jsx)(m.m,{children:(0,n.jsxs)(R.EO,{borderRadius:"xl",children:[(0,n.jsx)(b.r,{fontSize:"lg",fontWeight:"bold",children:"Delete Policy"}),(0,n.jsxs)(v.c,{children:['Are you sure you want to delete policy "',s,'"? This action cannot be undone.']}),(0,n.jsxs)(E.j,{children:[(0,n.jsx)(d.$,{ref:t,onClick:i,borderRadius:"xl",children:"Cancel"}),(0,n.jsx)(d.$,{colorScheme:"red",onClick:()=>{r(),i()},ml:3,borderRadius:"xl",children:"Delete"})]})]})})})}var A=i(2533),I=i(5442);function J(){return(0,n.jsx)(t.a,{bg:"white",borderBottom:"1px",borderColor:"gray.200",py:4,position:"sticky",top:0,zIndex:1,children:(0,n.jsx)(t.a,{mx:"auto",width:"100%",children:(0,n.jsxs)(A.s,{maxW:"container.xl",mx:"auto",width:"100%",justify:"space-between",align:"center",children:[(0,n.jsx)(I.D,{fontSize:"24px",fontWeight:"bold",fontFamily:"Inter, sans-serif",color:"black",children:"iCloud Photos Downloader"}),(0,n.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},borderRadius:"xl",fontFamily:"Inter, sans-serif",fontSize:"14px",children:"Settings"})]})})})}var L=i(1683);function T(e){let{title:o,children:i,headerRight:l,...r}=e;return(0,n.jsx)(t.a,{width:"100%",...r,children:(0,n.jsxs)(t.a,{bg:"white",borderRadius:"2xl",boxShadow:"sm",border:"1px",borderColor:"gray.200",display:"flex",flexDirection:"column",children:[(0,n.jsxs)(A.s,{px:6,py:4,borderBottom:"1px",borderColor:"gray.100",height:"56px",alignItems:"center",children:[(0,n.jsx)(f.E,{fontSize:"12px",fontWeight:"bold",color:"gray.500",letterSpacing:"0.05em",children:o.toUpperCase()}),(0,n.jsx)(L.h,{}),l]}),(0,n.jsx)(t.a,{py:8,px:12,flex:"1",minH:"200px",display:"flex",alignItems:"flex-start",width:"100%",children:i||(0,n.jsx)(f.E,{color:"gray.500",textAlign:"center",fontFamily:"Inter, sans-serif",fontSize:"14px",width:"100%",children:"Empty"})})]})})}var $=i(4893),q=i(4605),K=i(6317),N=i(6434),B=i(6344),U=i(1536);let H=e=>{let{isOpen:o,onClose:i,onConfirm:r,policyName:s}=e,t=(0,l.useRef)(null);return(0,n.jsx)(R.Lt,{isOpen:o,leastDestructiveRef:t,onClose:i,children:(0,n.jsx)(m.m,{children:(0,n.jsxs)(R.EO,{children:[(0,n.jsx)(b.r,{fontSize:"lg",fontWeight:"bold",children:"Interrupt Download"}),(0,n.jsxs)(v.c,{children:["Are you sure you want to interrupt the policy ",s,"? All downloaded files will be kept."]}),(0,n.jsxs)(E.j,{children:[(0,n.jsx)(d.$,{ref:t,onClick:i,children:"Cancel"}),(0,n.jsx)(d.$,{colorScheme:"red",onClick:r,ml:3,children:"Confirm"})]})]})})})},X=e=>{let{policies:o,setPolicies:i,onEdit:l,onDelete:r,onRun:s,onInterrupt:a,socket:d,toast:u}=e;return(0,n.jsx)(c.T,{spacing:2,width:"100%",align:"stretch",children:o.length>0?o.map(e=>(0,n.jsx)(Y,{policy:e,setPolicies:i,onEdit:l,onDelete:r,onRun:s,onInterrupt:a,socket:d,toast:u},e.name)):(0,n.jsx)(t.a,{height:"100px",display:"grid",placeItems:"center",children:(0,n.jsx)(f.E,{color:"gray.500",textAlign:"center",fontFamily:"Inter, sans-serif",fontSize:"14px",children:"No policies created yet"})})})},Y=e=>{let{policy:o,setPolicies:i,onEdit:s,onDelete:a,onRun:c,onInterrupt:d,socket:u,toast:x}=e,{isOpen:g,onToggle:m}=(0,r.j)(),{isOpen:j,onOpen:b,onClose:_}=(0,r.j)(),[v,y]=(0,l.useState)(!1);(0,l.useEffect)(()=>{"running"===o.status&&y(!1)},[o.status]);let C=(e=>"running"===e.status?{text:"running",color:"blue.500"}:"errored"===e.status?{text:"errored",color:"red.500"}:e.authenticated?100===e.progress?{text:"done",color:"green.500"}:{text:"ready",color:"green.500"}:{text:"unauthenticated",color:"gray.500"})(o);return(0,n.jsxs)(t.a,{width:"100%",borderWidth:"1px",borderRadius:"lg",overflow:"hidden",children:[(0,n.jsxs)(A.s,{p:4,justify:"space-between",align:"center",bg:g?"gray.50":"white",onClick:m,cursor:"pointer",_hover:{bg:"gray.50"},children:[(0,n.jsxs)(A.s,{flex:1,gap:4,children:[(0,n.jsx)(h.K,{"aria-label":"Expand row",icon:g?(0,n.jsx)(z.M,{}):(0,n.jsx)(D.D,{}),variant:"ghost",size:"sm"}),(0,n.jsxs)(t.a,{flex:1,children:[(0,n.jsx)(f.E,{fontSize:"16px",fontWeight:"medium",children:o.name}),(0,n.jsxs)(A.s,{gap:2,color:"gray.500",fontSize:"14px",children:[(0,n.jsx)(f.E,{color:C.color,fontWeight:"medium",children:C.text}),(0,n.jsx)(f.E,{children:"•"}),(0,n.jsx)(f.E,{children:o.username}),(0,n.jsx)(f.E,{children:"•"}),(0,n.jsx)(f.E,{children:o.directory})]})]}),(0,n.jsx)(t.a,{width:"150px",display:"flex",children:(0,n.jsxs)(t.a,{flex:"1",mt:1,children:[(0,n.jsx)(f.E,{fontSize:"12px",color:"gray.600",fontWeight:"medium",children:"running"===o.status?"".concat(o.progress||0,"%"):"IDLE"}),(0,n.jsx)(q.k,{value:o.progress||0,size:"sm",colorScheme:"running"===o.status?"blue":"errored"===o.status?"red":"green",borderRadius:"full"})]})})]}),(0,n.jsxs)(A.s,{gap:2,ml:4,children:[v?(0,n.jsx)(h.K,{"aria-label":"Loading",icon:(0,n.jsx)($.y,{size:"sm"}),colorScheme:"blue",variant:"ghost",size:"sm"}):"running"===o.status?(0,n.jsx)(h.K,{"aria-label":"Pause download",icon:(0,n.jsx)(U.kwt,{}),colorScheme:"blue",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),b()}}):(0,n.jsx)(h.K,{"aria-label":"Run policy",icon:(0,n.jsx)(U.gSK,{}),colorScheme:"green",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),u&&o.authenticated&&(y(!0),u.once("icloud_is_busy",()=>{y(!1)}),u.once("download_failed",()=>{y(!1)})),c(o)}}),(0,n.jsx)(h.K,{"aria-label":"Edit policy",icon:(0,n.jsx)(K.q,{}),colorScheme:"blue",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),s(o)},isDisabled:"running"===o.status}),(0,n.jsx)(h.K,{"aria-label":"Duplicate policy",icon:(0,n.jsx)(N.T,{}),colorScheme:"blue",variant:"ghost",size:"sm",onClick:e=>{if(e.stopPropagation(),!u)return;let n={...o,name:"".concat(o.name," COPY"),authenticated:!1};u.once("policies_after_create",e=>{i(e)}),u.once("error_creating_policy",e=>{let{policy_name:o,error:i}=e;x({title:"Error",description:'Failed to create policy "'.concat(o,'": ').concat(i),status:"error",duration:5e3,isClosable:!0})}),u.emit("createPolicy",n)},isDisabled:"running"===o.status}),(0,n.jsx)(h.K,{"aria-label":"Delete policy",icon:(0,n.jsx)(B.d,{}),colorScheme:"red",variant:"ghost",size:"sm",onClick:e=>{e.stopPropagation(),a(o)},isDisabled:"running"===o.status})]})]}),(0,n.jsx)(H,{isOpen:j,onClose:_,onConfirm:()=>{d(o),_()},policyName:o.name}),(0,n.jsx)(p.S,{in:g,children:(0,n.jsx)(t.a,{p:4,bg:"gray.50",children:(0,n.jsx)(t.a,{ml:12,maxH:"300px",overflowY:"auto",sx:{"&::-webkit-scrollbar":{width:"8px",borderRadius:"8px",backgroundColor:"rgba(0, 0, 0, 0.05)"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0, 0, 0, 0.1)",borderRadius:"8px","&:hover":{backgroundColor:"rgba(0, 0, 0, 0.15)"}}},children:(0,n.jsx)(f.E,{fontSize:"14px",fontFamily:"monospace",whiteSpace:"pre-wrap",sx:{wordBreak:"break-word"},children:o.logs||"No logs available"})})})})]})};var V=i(7511),Q=i(6758),G=i(4895),Z=i(6742);function ee(e){let{isOpen:o,onClose:i,onSubmit:r,username:s,socket:t}=e,[a,c]=(0,l.useState)(""),[u,p]=(0,l.useState)(!1),[_,w]=(0,l.useState)(!1),k=()=>{t&&(w(!0),t.once("authenticated",()=>{w(!1),i()}),t.once("authentication_failed",()=>{w(!1)}),r(a),c(""))};return(0,n.jsxs)(g.aF,{isOpen:o,onClose:i,isCentered:!0,children:[(0,n.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,n.jsxs)(j.$,{borderRadius:"xl",children:[(0,n.jsx)(b.r,{children:"Authentication Required"}),(0,n.jsx)(v.c,{children:(0,n.jsxs)(y.MJ,{children:[(0,n.jsx)(x.l,{children:_?(0,n.jsx)(A.s,{gap:2,align:"center",children:(0,n.jsx)(f.E,{children:"Authenticating..."})}):"Enter the password for iCloud user ".concat(s)}),(0,n.jsxs)(V.M,{children:[(0,n.jsx)(C.p,{type:u?"text":"password",value:a,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"===e.key&&a&&k()}}),(0,n.jsx)(Q.t,{children:(0,n.jsx)(h.K,{"aria-label":u?"Hide password":"Show password",icon:u?(0,n.jsx)(G.O,{}):(0,n.jsx)(Z.t,{}),variant:"ghost",onClick:()=>p(!u),size:"sm"})})]})]})}),(0,n.jsxs)(E.j,{children:[(0,n.jsx)(d.$,{variant:"ghost",mr:3,onClick:i,children:"Cancel"}),(0,n.jsx)(d.$,{colorScheme:"blue",onClick:k,isDisabled:!a||_,isLoading:_,children:"Submit"})]})]})]})}function eo(e){let{isOpen:o,onClose:i,onSubmit:r,error:s,socket:t}=e,[a,u]=(0,l.useState)(""),[h,p]=(0,l.useState)(!1),_=()=>{t&&(p(!0),t.once("authenticated",()=>{p(!1),i()}),t.once("authentication_failed",()=>{p(!1)}),t.once("mfa_required",()=>{p(!1)}),r(a),u(""))};return(0,n.jsxs)(g.aF,{isOpen:o,onClose:i,isCentered:!0,children:[(0,n.jsx)(m.m,{backdropFilter:"blur(4px)"}),(0,n.jsxs)(j.$,{borderRadius:"xl",children:[(0,n.jsx)(b.r,{children:"Two-Factor Authentication"}),(0,n.jsx)(v.c,{children:(0,n.jsxs)(c.T,{spacing:4,align:"stretch",children:[(0,n.jsxs)(y.MJ,{children:[(0,n.jsx)(x.l,{children:h?(0,n.jsx)(A.s,{gap:2,align:"center",children:(0,n.jsx)(f.E,{children:"Verifying..."})}):"Verification code is sent to your trusted devices"}),(0,n.jsx)(C.p,{type:"text",value:a,onChange:e=>u(e.target.value),onKeyDown:e=>{"Enter"===e.key&&a&&_()},placeholder:"Enter code",isDisabled:h})]}),s&&(0,n.jsx)(f.E,{color:"red.500",fontSize:"sm",children:s})]})}),(0,n.jsxs)(E.j,{children:[(0,n.jsx)(d.$,{variant:"ghost",mr:3,onClick:i,isDisabled:h,children:"Cancel"}),(0,n.jsx)(d.$,{colorScheme:"blue",onClick:_,isDisabled:!a||h,isLoading:h,children:"Submit"})]})]})]})}function ei(){let[e,o]=(0,l.useState)([]),[i,u]=(0,l.useState)(),[h,x]=(0,l.useState)(),[p,f]=(0,l.useState)(),[g,m]=(0,l.useState)(),{isOpen:j,onOpen:b,onClose:_}=(0,r.j)(),{isOpen:v,onOpen:y,onClose:C}=(0,r.j)(),{isOpen:w,onOpen:k,onClose:S}=(0,r.j)(),{isOpen:E,onOpen:z,onClose:D}=(0,r.j)(),P=O(),F=(0,s.d)();!function(e){let{socket:o,toast:i,setPolicies:n}=e;(0,l.useEffect)(()=>{if(!o)return;o.emit("getPolicies");let e=["policies","policies_after_save","policies_after_delete"];e.forEach(e=>{o.on(e,o=>{n(o),"policies"!==e&&i({title:"Success",description:{policies_after_save:"Policy saved successfully",policies_after_delete:"Policy deleted successfully"}[e],status:"success",duration:3e3,isClosable:!0})})});let l={connect_error:"Failed to connect to server",error_saving_policy:"Failed to save policy",error_deleting_policy:"Failed to delete policy",error_interrupting_download:"Failed to interrupt download",authentication_failed:"Authentication failed"};Object.entries(l).forEach(e=>{let[n,l]=e;o.on(n,e=>{let o=(null==e?void 0:e.error)||(null==e?void 0:e.message)||"",n=(null==e?void 0:e.policy_name)?' "'.concat(e.policy_name,'"'):"";i({title:"Error",description:"".concat(l).concat(n).concat(o?": "+o:""),status:"error",duration:5e3,isClosable:!0})})}),o.on("download_failed",e=>{let{policy:o,error:n,logs:l}=e;r(o),l&&s(o.name,l),i({title:"Error",description:'Error downloading photos for policy "'.concat(o.name,'": ').concat(n),status:"error",duration:5e3,isClosable:!0})}),o.on("authenticated",e=>{let{msg:o,policies:l}=e;i({title:"Authentication Successful",description:o,status:"success",duration:3e3,isClosable:!0}),n(l)}),o.on("mfa_required",e=>{i({title:"MFA Required",description:e,status:"info",duration:3e3,isClosable:!0})}),o.on("icloud_is_busy",e=>{i({title:"iCloud Account Busy",description:e,status:"info",duration:5e3,isClosable:!0})});let r=e=>{n(o=>o.map(o=>o.name===e.name?{...o,...e}:o))},s=(e,o)=>{n(i=>i.map(i=>i.name===e?{...i,logs:(i.logs||"")+o}:i))};return o.on("download_progress",e=>{let{policy:o,logs:i}=e;r(o),i&&s(o.name,i)}),o.on("download_finished",e=>{let{policy_name:o,progress:n,logs:l}=e;r({name:o,progress:n,status:"stopped"}),l&&s(o,l),i({title:"Download Complete",description:'Successfully downloaded photos for policy "'.concat(o,'"'),status:"success",duration:5e3,isClosable:!0})}),()=>{e.forEach(e=>o.off(e)),Object.keys(l).forEach(e=>o.off(e)),o.off("authenticated"),o.off("mfa_required"),o.off("download_progress"),o.off("download_finished"),o.off("download_failed"),o.off("icloud_is_busy")}},[o,i,n])}({socket:P,toast:F,setPolicies:o}),(0,l.useEffect)(()=>{if(!P)return;let e=()=>{S(),D()},o=e=>{S(),m(e),z()};return P.on("authenticated",e),P.on("mfa_required",o),()=>{P.off("authenticated",e),P.off("mfa_required",o)}},[P,p,S,D,z]);let R=()=>{u(void 0),_()};return(0,n.jsxs)(t.a,{bg:"gray.200",minH:"100vh",children:[(0,n.jsx)(J,{}),(0,n.jsxs)(a.m,{maxW:"container.xl",py:8,children:[(0,n.jsx)(c.T,{spacing:8,align:"center",width:"100%",children:(0,n.jsx)(t.a,{width:"100%",children:(0,n.jsx)(T,{title:"All Policies",headerRight:(0,n.jsx)(d.$,{bg:"black",color:"white",_hover:{bg:"gray.800"},borderRadius:"xl",fontFamily:"Inter, sans-serif",fontSize:"12px",size:"sm",px:4,onClick:()=>{u(void 0),b()},children:"Add"}),children:(0,n.jsx)(X,{policies:e,setPolicies:o,onEdit:e=>{u(e),b()},onDelete:e=>{x(e),y()},onRun:e=>{P&&(e.authenticated?(e.logs="",P.emit("start",e.name)):(f(e),k()))},onInterrupt:e=>{P&&P.emit("interrupt",e.name)},socket:P,toast:F})})})}),j&&(0,n.jsx)(M,{isOpen:!0,onClose:R,onPolicySaved:e=>{o(e),R()},isEditing:!!i,policy:i}),v&&(0,n.jsx)(W,{isOpen:v,onClose:C,onConfirm:()=>{h&&(null==P||P.emit("deletePolicy",h.name),C(),x(void 0))},policyName:(null==h?void 0:h.name)||""}),w&&(0,n.jsx)(ee,{isOpen:!0,onClose:()=>{S(),f(void 0)},onSubmit:e=>{P&&p&&P.emit("authenticate",p.name,e)},username:(null==p?void 0:p.username)||"",socket:P}),E&&(0,n.jsx)(eo,{isOpen:!0,onClose:()=>{D(),f(void 0),m(void 0)},onSubmit:e=>{P&&p&&(m(void 0),P.emit("provideMFA",p.name,e))},error:g,socket:P})]})]})}}},e=>{var o=o=>e(e.s=o);e.O(0,[711,647,648,441,517,358],()=>o(4180)),_N_E=e.O()}]);